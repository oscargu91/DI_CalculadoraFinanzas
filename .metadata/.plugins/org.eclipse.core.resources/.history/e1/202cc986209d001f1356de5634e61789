package com.carballeira.controller;

import com.carballeira.view.FinanceEntry;
import com.carballeira.view.Main;
import javafx.collections.ObservableList;
import javafx.scene.control.Alert;
import javafx.scene.control.Button;
import javafx.scene.layout.VBox;
import javafx.scene.chart.PieChart;

public class FinanceController {

    private Main vista;

    public FinanceController(Main vista) {
        this.vista = vista;
    }

    public void manejarInicioSesion(String usuario, String contrasena) {
        if (!usuario.isEmpty() && !contrasena.isEmpty()) {
            // Lógica para iniciar sesión
            vista.mostrarPantallaPrincipal(new Stage());
        } else {
            vista.showAlert("Error", "Debe rellenar todos los campos para iniciar sesión.");
        }
    }

    public void agregarEntrada(String entryName, String entryAmount, String entryType, ObservableList<FinanceEntry> financeData) {
        try {
            FinanceEntry.validarEntrada(entryName, entryAmount, entryType);
            double cantidad = Double.parseDouble(entryAmount);
            Button eliminar = new Button("Eliminar");
            FinanceEntry newEntry = new FinanceEntry(entryName, cantidad, entryType, eliminar);
            financeData.add(newEntry);
        } catch (IllegalArgumentException e) {
            vista.showAlert("Error", e.getMessage());
        }
    }

    public void calcularMeta(String metaAmount, VBox chartContainer, ObservableList<FinanceEntry> financeData) {
        // Lógica para calcular la meta y mostrarla en el gráfico
        try {
            double meta = Double.parseDouble(metaAmount);
            double total = financeData.stream().mapToDouble(FinanceEntry::getAmount).sum();
            double percentage = (total / meta) * 100;

            PieChart pieChart = new PieChart();
            pieChart.getData().add(new PieChart.Data("Cumplimiento", percentage));
            pieChart.getData().add(new PieChart.Data("Faltante", 100 - percentage));
            chartContainer.getChildren().clear();
            chartContainer.getChildren().add(pieChart);
            chartContainer.setVisible(true);

        } catch (NumberFormatException e) {
            vista.showAlert("Error", "Introduzca un número válido para la meta.");
        }
    }
}
